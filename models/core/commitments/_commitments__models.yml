version: 2

models:
  - name: dim_commitments
    description: "Canonical commitment dimension - investor commitments to funds"
    columns:
      - name: commitment_id
        description: "Unique commitment identifier - Primary Key"
        tests:
          - unique
          - not_null
      
      - name: fund_id
        description: "Fund to which the commitment is made - Foreign Key to dim_funds"
        tests:
          - not_null
          - relationships:
              to: ref('dim_funds')
              field: fund_id
      
      - name: investor_id
        description: "Investor making the commitment - Foreign Key to dim_investors"
        tests:
          - not_null
          - relationships:
              to: ref('dim_investors')
              field: investor_id
      
      - name: currency_code
        description: "Currency code for the commitment - Foreign Key to dim_currencies"
        tests:
          - relationships:
              to: ref('dim_currencies')
              field: currency_code
      
      - name: original_amount
        description: "Original committed amount"
      
      - name: agreement_date
        description: "Commitment agreement date"
      
      - name: created_at
        description: "Timestamp when the commitment record was created"
      
      - name: updated_at
        description: "Timestamp when the commitment record was last updated"

  - name: fct_commitment_snapshots
    description: "Fact table for investor commitment snapshots over time"
    columns:
      - name: commitment_snapshot_id
        description: "Unique commitment snapshot identifier - Primary Key"
        tests:
          - unique
          - not_null
      
      - name: commitment_id
        description: "Commitment identifier - Foreign Key to dim_commitments"
        tests:
          - not_null
          - relationships:
              to: ref('dim_commitments')
              field: commitment_id
      
      - name: period_start_date
        description: "Start date of the reporting period"
      
      - name: period_end_date
        description: "End date of the reporting period"
        tests:
          - not_null
      
      - name: frequency
        description: "Reporting frequency (e.g., QUARTERLY, ANNUAL)"
      
      - name: reporting_basis
        description: "Reporting basis (e.g., GAAP, IFRS)"
        tests:
          - not_null
      
      - name: snapshot_source
        description: "Source of the snapshot data"
        tests:
          - not_null
          - accepted_values:
              values: ['ADMIN', 'INTERNAL']
      
      - name: currency_code
        description: "Currency code for the snapshot - Foreign Key to dim_currencies"
        tests:
          - relationships:
              to: ref('dim_currencies')
              field: currency_code
      
      - name: total_commitment
        description: "Total commitment amount"
      
      - name: total_drawdowns
        description: "Total drawdowns to date"
      
      - name: total_distributions
        description: "Total distributions to date"
      
      - name: source
        description: "Source system for the snapshot"
      
      - name: source_reference
        description: "Source system reference"
      
      - name: created_at
        description: "Timestamp when the snapshot record was created"
      
      - name: updated_at
        description: "Timestamp when the snapshot record was last updated"
