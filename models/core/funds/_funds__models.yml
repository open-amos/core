version: 2

models:
  - name: dim_funds
    description: "Canonical fund dimension - master data for all funds across the warehouse"
    columns:
      - name: fund_id
        description: "Unique fund identifier - Primary Key"
        tests:
          - unique
          - not_null
      
      - name: name
        description: "Fund name"
        tests:
          - not_null
      
      - name: type
        description: "Fund type (e.g., Private Equity, Venture Capital, Credit)"
      
      - name: vintage
        description: "Vintage year of the fund"
      
      - name: management_fee
        description: "Management fee rate as decimal"
      
      - name: hurdle
        description: "Hurdle rate as decimal"
      
      - name: carried_interest
        description: "Carried interest rate as decimal"
      
      - name: target_commitment
        description: "Target commitment amount"
      
      - name: incorporated_in
        description: "Jurisdiction where fund is incorporated"
      
      - name: strategy
        description: "Investment strategy description"
      
      - name: final_close_date
        description: "Final close date of the fund"
      
      - name: base_currency_code
        description: "Base currency code for the fund - Foreign Key to dim_currencies"
        tests:
          - relationships:
              to: ref('dim_currencies')
              field: currency_code
      
      - name: created_at
        description: "Timestamp when the fund record was created"
      
      - name: updated_at
        description: "Timestamp when the fund record was last updated"

  - name: fct_fund_snapshots
    description: "Fact table for fund performance snapshots over time"
    columns:
      - name: fund_snapshot_id
        description: "Unique fund snapshot identifier - Primary Key"
        tests:
          - unique
          - not_null
      
      - name: fund_id
        description: "Fund identifier - Foreign Key to dim_funds"
        tests:
          - not_null
          - relationships:
              to: ref('dim_funds')
              field: fund_id
      
      - name: period_start_date
        description: "Start date of the reporting period"
      
      - name: period_end_date
        description: "End date of the reporting period"
        tests:
          - not_null
      
      - name: frequency
        description: "Reporting frequency (e.g., QUARTERLY, ANNUAL)"
      
      - name: reporting_basis
        description: "Reporting basis (e.g., GAAP, IFRS)"
        tests:
          - not_null
      
      - name: snapshot_source
        description: "Source of the snapshot data"
        tests:
          - not_null
          - accepted_values:
              values: ['ADMIN', 'INTERNAL']
      
      - name: currency_code
        description: "Currency code for the snapshot - Foreign Key to dim_currencies"
        tests:
          - relationships:
              to: ref('dim_currencies')
              field: currency_code
      
      - name: committed_capital
        description: "Total committed capital"
      
      - name: called_capital
        description: "Total called capital"
      
      - name: dpi
        description: "Distributions to Paid-In capital ratio"
      
      - name: rvpi
        description: "Residual Value to Paid-In capital ratio"
      
      - name: expected_coc
        description: "Expected cash-on-cash return"
      
      - name: cash_amount
        description: "Cash amount held by the fund"
      
      - name: total_distributions
        description: "Total distributions made"
      
      - name: total_expenses
        description: "Total expenses incurred"
      
      - name: total_management_fees
        description: "Total management fees paid"
      
      - name: source
        description: "Source system for the snapshot"
      
      - name: source_reference
        description: "Source system reference"
      
      - name: total_interest_income
        description: "Total interest income earned"
      
      - name: created_at
        description: "Timestamp when the snapshot record was created"
      
      - name: updated_at
        description: "Timestamp when the snapshot record was last updated"
