Enum "amortization_type" {
    "BULLET"
    "STRAIGHT_LINE"
    "CUSTOM_SCHEDULE"
}

Enum "day_count" {
    "30E_360"
    "ACT_360"
    "ACT_365"
    "ACT_ACT"
}

Enum "facility_type" {
    "TERM_LOAN_B"
    "UNITRANCHE"
    "REVOLVER"
    "DELAYED_DRAWDOWN"
    "MEZZANINE"
    "RCF"
    "BRIDGE"
}

Enum "instrument_cashflow_type" {
    "INVESTMENT"
    "RETURN_OF_CAPITAL"
    "DIVIDEND"
    "EXIT_PROCEEDS"
    "DRAW"
    "PRINCIPAL"
    "INTEREST"
    "PREPAYMENT"
    "FEE"
    "OTHER"
}

Enum "instrument_type" {
    "EQUITY"
    "CREDIT"
}

Enum "interest_index" {
    "SOFR"
    "EURIBOR"
    "SONIA"
    "FED_FUNDS"
    "FIXED"
}

Enum "instrument_credit_type" {
    "TERM"
    "REVOLVER"
    "DDTL"
    "BRIDGE"
    "MEZZ"
}

Enum "security_rank" {
    "SENIOR_SECURED"
    "SENIOR_UNSECURED"
    "SECOND_LIEN"
    "MEZZANINE"
    "PIK"
}

Enum "snapshot_source" {
    "ADMIN"
    "INTERNAL"
}

Enum "syndicate_role" {
    "AGENT"
    "ARRANGER"
    "LENDER"
    "CO_LENDER"
    "ADMIN_AGENT"
}

Enum "tx_type" {
    "DRAWDOWN"
    "DISTRIBUTION"
    "DIVIDEND"
    "INVESTMENT_TRANSACTION"
    "EXPENSE"
    "MANAGEMENT_FEE"
    "LOAN_RECEIVED"
    "LOAN_DRAW"
    "LOAN_PRINCIPAL_REPAYMENT"
    "LOAN_INTEREST_RECEIPT"
    "LOAN_FEE_RECEIPT"
}

Enum "fund_type" {
    "EQUITY"
    "CREDIT"
}

Enum "valuation_type" {
    "ACTUAL"
    "FORECAST"
}

Table "public"."currencies" {
  "currency_code" varchar(3) [pk, not null]
  "name" varchar(128) [not null]
  "symbol" varchar(10)
  "created_at" timestamp
  "updated_at" timestamp
}

Table "public"."funds" {
  "fund_id" varchar(64) [pk, not null]
  "name" varchar(255) [not null]
  "type" fund_type [not null]
  "vintage" integer
  "management_fee" decimal(7,4)
  "hurdle" decimal(7,4)
  "carried_interest" decimal(7,4)
  "target_commitment" numeric(20,2)
  "incorporated_in" varchar(128)
  "base_currency_code" varchar(3) [ref: < "public"."currencies"."currency_code"]
  "strategy" text
  "final_close_date" date
  "created_at" timestamp
  "updated_at" timestamp
  Note: 'On-delete behavior to enforce in SQL migrations: funds -> commitments/transactions [RESTRICT].'
}

Table "public"."fund_snapshots" {
  "fund_snapshot_id" varchar(500) [pk, not null]
  "fund_id" varchar(64) [not null, ref: < "public"."funds"."fund_id"]
  "period_start_date" date
  "period_end_date" date [not null]
  "frequency" varchar(32) [note: 'ANNUAL | QUARTERLY | MONTHLY | DAILY']
  "reporting_basis" varchar(32) [note: 'AUDITED | MANAGEMENT | ESTIMATE']
  "snapshot_source" snapshot_source [not null, default: `INTERNAL`]
  "currency_code" varchar(3) [ref: < "public"."currencies"."currency_code"]
  "source" varchar(128)
  "source_reference" varchar(400)
  "nav_amount" numeric(20,2) [note: 'Net Asset Value in native currency']
  "nav_amount_converted" numeric(20,2) [note: 'Net Asset Value converted to fund base currency']
  "committed_capital" numeric(20,2)
  "called_capital" numeric(20,2)
  "dpi" decimal(18,10)
  "rvpi" decimal(18,10)
  "expected_coc" decimal(18,10)
  "cash_amount" numeric(20,2)
  "total_distributions" numeric(20,2)
  "total_expenses" numeric(20,2)
  "total_management_fees" numeric(20,2)
  "total_interest_income" numeric(20,2)
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    (fund_id, period_end_date, reporting_basis, snapshot_source) [unique, name: "idx_fund_snap_key"]
    fund_id [name: "idx_fund_snap_fund_id"]
    period_end_date [name: "idx_fund_snap_period_end"]
  }
}

Table "public"."companies" {
  "company_id" varchar(64) [pk, not null]
  "name" varchar(255) [not null]
  "website" varchar(255)
  "description" text
  "currency_code" varchar(3) [ref: < "public"."currencies"."currency_code"]
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    name [name: "idx_companies_name"]
  }
  Note: 'A company may belong to multiple industries via company_industry (no single industry_id FK).'
}

Table "public"."share_classes" {
  "share_class_id" varchar(64) [pk, not null]
  "company_id" varchar(64) [not null, ref: < "public"."companies"."company_id"]
  "name" varchar(128) [not null]
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    (company_id, name) [unique, name: "idx_share_class_company_id_name"]
    company_id [name: "idx_share_class_company_id"]
  }
}

Table "public"."company_valuations" {
  "company_valuation_id" varchar(64) [pk, not null]
  "company_id" varchar(64) [not null, ref: < "public"."companies"."company_id"]
  "period_start_date" date
  "period_end_date" date [not null]
  "frequency" varchar(32) [note: 'ANNUAL | QUARTERLY | MONTHLY | DAILY']
  "reporting_basis" varchar(32) [note: 'AUDITED | MANAGEMENT | ESTIMATE']
  "snapshot_source" snapshot_source [not null, default: `INTERNAL`]
  "amount" numeric(20,2)
  "valuation_type" valuation_type
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    (company_id, period_end_date, valuation_type, reporting_basis, snapshot_source) [unique, name: "idx_company_valuation_key"]
    company_id [name: "idx_company_valuation_company_id"]
    period_end_date [name: "idx_company_valuation_period_end"]
  }
}

Table "public"."company_financials" {
  "company_performance_snapshot_id" varchar(64) [pk, not null]
  "company_id" varchar(64) [not null, ref: < "public"."companies"."company_id"]
  "period_start_date" date [note: 'Optional; some ERPs export start/end']
  "period_end_date" date [not null]
  "frequency" varchar(32) [note: 'ANNUAL | QUARTERLY | MONTHLY']
  "reporting_basis" varchar(32) [note: 'AUDITED | MANAGEMENT | ESTIMATE']
  "snapshot_source" snapshot_source
  "currency_code" varchar(3)
  "revenue" numeric(24,2)
  "cost_of_goods_sold" numeric(24,2)
  "gross_profit" numeric(24,2)
  "operating_expenses" numeric(24,2)
  "ebitda" numeric(24,2)
  "depreciation_amortization" numeric(24,2)
  "ebit" numeric(24,2)
  "net_income" numeric(24,2)
  "cash" numeric(24,2)
  "total_assets" numeric(24,2)
  "total_liabilities" numeric(24,2)
  "equity" numeric(24,2)
  "operating_cash_flow" numeric(24,2)
  "investing_cash_flow" numeric(24,2)
  "financing_cash_flow" numeric(24,2)
  "source_system" varchar(64)
  "source_file_ref" varchar(255)
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    (company_id, period_end_date, reporting_basis, snapshot_source) [unique, name: "idx_company_financials_key"]
    company_id [name: "idx_company_financials_company_id"]
    period_end_date [name: "idx_company_financials_period_end"]
  }
}

Table "public"."investor_types" {
  "investor_type_id" varchar(64) [pk, not null]
  "name" varchar(128) [not null]
  "description" text
  "kyc_category" varchar(128)
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    name [unique, name: "uq_investor_types_name"]
  }
}

Table "public"."investors" {
  "investor_id" varchar(64) [pk, not null]
  "name" varchar(255) [not null]
  "investor_type_id" varchar(64) [ref: < "public"."investor_types"."investor_type_id"]
  "domicile_country_code" "char(2)" [ref: < "public"."countries"."country_iso2_code"]
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    investor_type_id [name: "idx_investor_investor_type_id"]
  }
}

Table "public"."instruments" {
  "instrument_id" varchar(64) [pk, not null, ref: < "public"."instrument_countries"."instrument_id", ref: < "public"."instrument_industries"."instrument_id", ref: < "public"."instruments_equity"."instrument_id"]
  "fund_id" varchar(64) [not null, ref: < "public"."funds"."fund_id"]
  "company_id" varchar(64) [not null, ref: < "public"."companies"."company_id"]
  "name" varchar(255) [not null]
  "instrument_type" instrument_type [not null]
  "inception_date" date
  "termination_date" date
  "description" text
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    fund_id [name: "idx_instrument_fund_id"]
    company_id [name: "idx_instrument_company_id"]
    (fund_id, company_id, instrument_type) [name: "idx_instrument_key"]
  }
  Note: 'On-delete behavior to enforce in SQL migrations: instruments -> instrument_snapshots/instrument_cashflows [RESTRICT or CASCADE].'
}

Table "public"."instrument_snapshots" {
  "instrument_snapshot_id" varchar(64) [pk, not null]
  "instrument_id" varchar(64) [not null, ref: < "public"."instruments"."instrument_id"]
  "period_start_date" date
  "period_end_date" date [not null]
  "frequency" varchar(32) [note: 'ANNUAL | QUARTERLY | MONTHLY | DAILY']
  "reporting_basis" varchar(32) [note: 'AUDITED | MANAGEMENT | ESTIMATE']
  "snapshot_source" snapshot_source [not null]
  "snapshot_source_file_ref" varchar(255)
  "currency_code" varchar(3) [not null, ref: < "public"."currencies"."currency_code"]
  "fx_rate" numeric(18,8) [note: 'base-per-native; *_converted = * * fx_rate']
  "fx_rate_as_of" date
  "fx_rate_source" varchar(64)
  "fair_value" numeric(24,2)
  "fair_value_converted" numeric(24,2)
  "accrued_income" numeric(24,2)
  "accrued_income_converted" numeric(24,2)
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    (instrument_id, period_end_date, reporting_basis, snapshot_source) [unique, name: "idx_instrument_snapshot_key"]
    instrument_id [name: "idx_instrument_snapshot_instrument_id"]
    period_end_date [name: "idx_instrument_snapshot_period_end"]
    (instrument_id, period_end_date) [name: "idx_instr_snap_instrument_end"]
    (reporting_basis, snapshot_source) [name: "idx_instr_snap_basis_source"]
  }
  Note: 'Null = not applicable/not reported; 0 = true zero; fx_rate > 0 when provided.'
}

Table "public"."instrument_cashflows" {
  "instrument_cashflow_id" varchar(64) [pk, not null]
  "instrument_id" varchar(64) [not null, ref: < "public"."instruments"."instrument_id"]
  "instrument_cashflow_type" instrument_cashflow_type [not null]
  "date" date [not null]
  "currency_code" varchar(3) [not null, ref: < "public"."currencies"."currency_code"]
  "fx_rate" numeric(18,8)
  "fx_rate_as_of" date
  "fx_rate_source" varchar(64)
  "amount" numeric(24,2) [not null]
  "amount_converted" numeric(24,2)
  "transaction_id" varchar(64)
  "reference" varchar(255)
  "non_cash" boolean [default: false]
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    instrument_id [name: "idx_instr_cf_instrument_id"]
    (instrument_id, date) [name: "idx_instr_cf_instrument_date"]
    date [name: "idx_instr_cf_date"]
    transaction_id [name: "idx_instr_cf_tx_id"]
    (instrument_id, instrument_cashflow_type, date) [name: "idx_instr_cf_type_date"]
  }
  Note: 'Canonical cashflow taxonomy: Equity outflows (INVESTMENT), Equity inflows (EXIT_PROCEEDS, RETURN_OF_CAPITAL, DIVIDEND), Credit outflows (DRAW), Credit inflows (PRINCIPAL, INTEREST, PREPAYMENT), Shared (FEE, OTHER). Data quality checks: amount >= 0 when non_cash=false; fx_rate > 0 when provided.'
}

Table "public"."opportunity_countries" {
  "opportunity_id" varchar(64) [not null, ref: < "public"."opportunities"."opportunity_id"]
  "country_code" "char(2)" [not null, ref: < "public"."countries"."country_iso2_code"]
  "primary_flag" boolean [not null]
  "allocation_pct" decimal(5,2)
  "role" varchar(32)
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    (opportunity_id, country_code) [pk, name: "pk_opportunity_country"]
    opportunity_id [name: "idx_opportunity_country_opportunity_id"]
    country_code [name: "idx_opportunity_country_country_code"]
  }
}

Table "public"."commitments" {
  "commitment_id" varchar(64) [pk, not null]
  "fund_id" varchar(64) [not null]
  "investor_id" varchar(64) [not null, ref: < "public"."investors"."investor_id"]
  "currency_code" varchar(3) [ref: < "public"."currencies"."currency_code"]
  "original_amount" numeric(20,2)
  "agreement_date" date
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    (fund_id, investor_id) [unique, name: "idx_commitment_fund_id_investor_id"]
    fund_id [name: "idx_commitments_fund_id"]
    investor_id [name: "idx_commitments_investor_id"]
  }
}

Table "public"."instrument_countries" {
  "instrument_id" varchar(64) [not null]
  "country_code" "char(2)" [not null]
  "valid_from" date [not null]
  "valid_to" date
  "allocation_pct" decimal(5,2)
  "role" varchar(32)
  "primary_flag" boolean
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    (instrument_id, country_code, valid_from) [pk, name: "pk_instrument_country"]
    instrument_id [name: "idx_instrument_country_instrument_id"]
    country_code [name: "idx_instrument_country_country_code"]
    valid_from [name: "idx_instrument_country_valid_from"]
  }
  Note: 'No overlapping intervals per (instrument_id, country_code); at most one primary per instrument across active rows; allocation_pct between 0 and 100.'
}

Table "public"."countries" {
  "country_iso2_code" "char(2)" [unique, not null, ref: < "public"."instrument_countries"."country_code"]
  "country_iso3_code" "char(3)"
  "name" varchar(128) [not null]
  "region" varchar(255)
  "subregion" varchar(255)
  "income_level" varchar(6)
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    name [name: "idx_countries_name"]
    region [name: "idx_countries_region"]
    subregion [name: "idx_countries_subregion"]
  }
}

Table "public"."commitment_snapshots" {
  "commitment_snapshot_id" varchar(64) [pk, not null]
  "commitment_id" varchar(64) [not null, ref: < "public"."commitments"."commitment_id"]
  "period_start_date" date
  "period_end_date" date
  "frequency" varchar(32)
  "reporting_basis" varchar(32)
  "snapshot_source" snapshot_source
  "currency_code" varchar(3) [ref: < "public"."currencies"."currency_code"]
  "source" varchar(128)
  "source_reference" varchar(400)
  "total_commitment" numeric(20,2)
  "total_drawdowns" numeric(20,2)
  "total_distributions" numeric(20,2)
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    (commitment_id, period_end_date, reporting_basis, snapshot_source) [unique, name: "idx_commitment_snap_key"]
    commitment_id [name: "idx_commitment_metrics_commitment_id"]
  }
}

Table "public"."instrument_industries" {
  "instrument_id" varchar(64) [not null]
  "industry_id" varchar(64) [not null]
  "allocation_pct" decimal(5,2)
  "primary_flag" boolean
  "valid_from" date [not null]
  "valid_to" date
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    (instrument_id, industry_id, valid_from) [pk, name: "pk_instrument_industry"]
    instrument_id [name: "idx_instrument_industry_instrument_id"]
    industry_id [name: "idx_instrument_industries_industry_id"]
    valid_from [name: "idx_instrument_industries_valid_from"]
  }
  Note: 'Ensure no overlapping (instrument_id, industry_id) intervals; at most one primary per instrument across active rows; allocation_pct between 0 and 100.'
}

Table "public"."company_industries" {
  "company_id" varchar(64) [not null, ref: < "public"."companies"."company_id"]
  "industry_id" varchar(64) [not null, ref: < "public"."industries"."industry_id"]
  "valid_from" date [not null]
  "valid_to" date
  "primary_flag" boolean
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    (company_id, industry_id, valid_from) [pk, name: "pk_company_industry_company_id_industry_id_valid_from"]
    company_id [name: "idx_company_industry_company_id"]
    industry_id [name: "idx_company_industry_industry_id"]
  }
  Note: 'Optional: allocation_pct if you need multi-industry weights. Ensure no overlapping intervals; at most one primary per company among active rows.'
}

Table "public"."company_countries" {
  "company_id" varchar(64) [not null, ref: < "public"."companies"."company_id"]
  "country_code" "char(2)" [not null, ref: < "public"."countries"."country_iso2_code"]
  "valid_from" date [not null]
  "valid_to" date
  "allocation_pct" decimal(5,2)
  "role" varchar(32)
  "primary_flag" boolean
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    (company_id, country_code, valid_from) [pk, name: "pk_company_countries_company_id_country_code_valid_from"]
    company_id [name: "idx_company_countries_company_id"]
    country_code [name: "idx_company_countries_country_code"]
  }
  Note: 'No overlapping intervals per (company_id, country_code); at most one primary per company among active rows; allocation_pct between 0 and 100.'
}

Table "public"."instruments_equity" {
  "instrument_id" varchar(64) [pk, not null]
  "share_class_id" varchar(64) [not null, ref: < "public"."share_classes"."share_class_id"]
  "initial_share_count" numeric(24,6)
  "initial_ownership_pct" numeric(7,6)
  "initial_cost" numeric(24,2)
  "initial_price_per_share" numeric(24,6)
  "currency_code" varchar(3) [ref: < "public"."currencies"."currency_code"]
  "fx_rate" numeric(18,8) [note: 'base-per-native; initial_cost_converted = initial_cost * fx_rate']
  "fx_rate_as_of" date
  "fx_rate_source" varchar(64)
  "initial_cost_converted" numeric(24,2)
  "description" text
  "created_at" timestamp
  "updated_at" timestamp
  Note: 'Capture either shares or pct (or both); validate 0 <= initial_ownership_pct <= 1.0 (or 0..100 if you prefer percent scale). If FX provided, fx_rate > 0. initial_cost >= 0 when provided.'
}

Table "public"."stages" {
  "stage_id" varchar(64) [pk, not null]
  "name" varchar(128) [not null]
  "type" varchar(64)
  "order" integer
  "created_at" timestamp
  "updated_at" timestamp
}

Table "public"."facilities" {
  "facility_id" varchar(64) [pk, not null]
  "fund_id" varchar(64) [not null, ref: < "public"."funds"."fund_id"]
  "borrower_company_id" varchar(64) [not null, ref: < "public"."companies"."company_id"]
  "facility_type" facility_type [not null]
  "agreement_date" date [not null]
  "effective_date" date
  "maturity_date" date
  "currency_code" varchar(3) [not null, ref: < "public"."currencies"."currency_code"]
  "total_commitment" numeric(24,2)
  "purpose" varchar(256)
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    fund_id [name: "idx_facility_fund_id"]
    borrower_company_id [name: "idx_facility_borrower_company_id"]
    (fund_id, borrower_company_id, agreement_date) [name: "idx_facility_key"]
  }
}

Table "public"."opportunities" {
  "opportunity_id" varchar(64) [pk, not null]
  "fund_id" varchar(64) [ref: < "public"."funds"."fund_id"]
  "name" varchar(255) [not null]
  "stage_id" varchar(64) [ref: < "public"."stages"."stage_id"]
  "company_id" varchar(64) [ref: < "public"."companies"."company_id"]
  "responsible" varchar(255)
  "amount" numeric(20,2)
  "next_step" varchar(255)
  "source" varchar(128)
  "close_date" date
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    fund_id [name: "idx_opportunity_fund_id"]
    stage_id [name: "idx_opportunity_stage_id"]
    company_id [name: "idx_opportunity_company_id"]
  }
}

Table "public"."industries" {
  "industry_id" varchar(64) [pk, not null, ref: < "public"."instrument_industries"."industry_id"]
  "name" varchar(128) [unique, not null]
  "created_at" timestamp
  "updated_at" timestamp
}

Table "public"."opportunity_industries" {
  "opportunity_id" varchar(64) [not null, ref: < "public"."opportunities"."opportunity_id"]
  "industry_id" varchar(64) [not null, ref: < "public"."industries"."industry_id"]
  "primary_flag" boolean
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    (opportunity_id, industry_id) [pk, name: "pk_opportunity_industry_opportunity_id_industry_id"]
    opportunity_id [name: "idx_opportunity_industries_opportunity_id"]
    industry_id [name: "idx_opportunity_industries_industry_id"]
  }
}

Table "public"."instruments_credit" {
  "instrument_id" varchar(64) [pk, not null, ref: < "public"."instruments"."instrument_id"]
  "facility_id" varchar(64) [not null, ref: < "public"."facilities"."facility_id"]
  "instrument_credit_type" instrument_credit_type [not null]
  "tranche_label" varchar(64)
  "commitment_amount" numeric(24,2)
  "currency_code" varchar(3) [ref: < "public"."currencies"."currency_code"]
  "fx_rate" numeric(18,8) [note: 'base-per-native; commitment_amount_converted = commitment_amount * fx_rate']
  "fx_rate_as_of" date
  "fx_rate_source" varchar(64)
  "commitment_amount_converted" numeric(24,2)
  "start_date" date [not null]
  "maturity_date" date [not null]
  "interest_index" interest_index [not null]
  "index_tenor_days" integer
  "fixed_rate_pct" decimal(7,4)
  "spread_bps" integer [not null]
  "floor_pct" decimal(7,4)
  "day_count" day_count [not null]
  "pay_freq_months" integer [not null]
  "amortization_type" amortization_type [not null]
  "security_rank" security_rank
  "status" varchar(32)
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    facility_id [name: "idx_loan_facility_id"]
  }
  Note: 'Instrument-level committed amount mirrors source systems; FX fields optional but if provided fx_rate > 0. Enforce unique (facility_id, tranche_label) where tranche_label is not null. commitment_amount >= 0 when provided.'
}

Table "transactions" {
  "transaction_id" varchar(64) [pk, not null]
  "transaction_type" tx_type [not null]
  "fund_id" varchar(64) [not null, ref: < "public"."funds"."fund_id"]
  "investor_id" varchar(64) [ref: < "public"."investors"."investor_id"]
  "facility_id" varchar(64) [ref: < "public"."facilities"."facility_id"]
  "instrument_id" varchar(64) [ref: < "public"."instruments"."instrument_id"]
  "amount" numeric(24,2) [not null]
  "currency_code" varchar(3) [not null, ref: < "public"."currencies"."currency_code"]
  "fx_rate" numeric(18,8)
  "fx_rate_as_of" date
  "fx_rate_source" varchar(64)
  "amount_converted" numeric(24,2)
  "date" date [not null]
  "source" varchar(128) [not null]
  "reference" varchar(255)
  "source_reference" varchar(400) [not null]
  "name" varchar(255)
  "description" text
  "created_at" timestamp
  "updated_at" timestamp

  Indexes {
    fund_id [name: "idx_tx_fund_id"]
    investor_id [name: "idx_tx_investor_id"]
    facility_id [name: "idx_tx_facility_id"]
    instrument_id [name: "idx_tx_instrument_id"]
    date [name: "idx_tx_date"]
    (transaction_type, date) [name: "idx_tx_type_date"]
    source_reference [unique, name: "uq_tx_source_reference"]
  }
  Note: 'Ledger-only: one row per cash movement. Non-cash lives in instrument_cashflows. Domain XOR (enforce in tests/migrations): investor events: investor_id not null; facility_id, instrument_id null; facility events: facility_id not null; investor_id, instrument_id null; instrument events: instrument_id not null; investor_id, facility_id null; fund-level: all three null. Amount/FX quality: amount >= 0; fx_rate > 0 when provided; do not set facility_id when instrument_id is present.'
}

Table "public"."instrument_snapshots_credit" {
  "instrument_snapshot_id" varchar(64) [pk, not null, ref: < "public"."instrument_snapshots"."instrument_snapshot_id"]
  "principal_outstanding" numeric(24,2)
  "principal_outstanding_converted" numeric(24,2)
  "undrawn_commitment" numeric(24,2)
  "undrawn_commitment_converted" numeric(24,2)
  "accrued_interest" numeric(24,2)
  "accrued_interest_converted" numeric(24,2)
  "accrued_fees" numeric(24,2)
  "accrued_fees_converted" numeric(24,2)
  "amortized_cost" numeric(24,2)
  "amortized_cost_converted" numeric(24,2)
  "expected_loss" numeric(24,2)
  "status" varchar(32)
  "created_at" timestamp [default: `CURRENT_TIMESTAMP`]
  "updated_at" timestamp [default: `CURRENT_TIMESTAMP`]
  Note: 'Null vs zero semantics mirror instrument_snapshot; non-negative when reported: principal_outstanding, undrawn_commitment, accrued_*.'
}

Table "public"."instrument_snapshots_equity" {
  "instrument_snapshot_id" varchar(64) [pk, not null, ref: < "public"."instrument_snapshots"."instrument_snapshot_id"]
  "equity_stake_pct" numeric(7,6)
  "stake_basis" varchar(32)
  "created_at" timestamp [default: `CURRENT_TIMESTAMP`]
  "updated_at" timestamp [default: `CURRENT_TIMESTAMP`]
  Note: 'Null vs zero semantics mirror instrument_snapshot.'
}
